#!/bin/bash

#Make sure we are root to proceed with installing libraries

if [[ $UID != 0 ]]; then
    echo "Please run this script with sudo or root privileges."
    echo "sudo $0 $*"
    exit 1
else

echo "Installing intel media driver for Intel 8th Generation + Graphics"

#copy, extract, and install intel video driver
cp /root/shadowroot/iHD_drv_video.so.gz /tmp/
gzip -d /tmp/iHD_drv_video.so.gz
cp /tmp/iHD_drv_video.so /usr/lib/x86_64-linux-gnu/dri/

#copy, extract, and install libigdgmm to the intel driver works
cp /root/shadowroot/libigdgmm.so.11.1.0.gz /tmp/
gzip -d /tmp/libigdgmm.so.11.1.0.gz
cp /tmp/libigdgmm.so.11.1.0 /usr/lib/x86_64-linux-gnu/
ln -s /usr/lib/x86_64-linux-gnu/libigdgmm.so.11.1.0 /usr/lib/x86_64-linux-gnu/libigdgmm.so.11
ln -s /usr/lib/x86_64-linux-gnu/libigdgmm.so.11 /usr/lib/x86_64-linux-gnu/libigdgmm.so

#install dependencies for libva compilation
apt-get install -y --no-install-recommends autoconf libtool libdrm-dev

#download, compile and install libva
cd /root
git clone https://github.com/intel/libva.git
cd libva
./autogen.sh --prefix=/usr --libdir=/usr/lib/x86_64-linux-gnu
make
make install

#add exports to env so it works as the user
echo LIBVA_DRIVERS_PATH=/usr/lib/x86_64-linux-gnu/dri >> /etc/environment
echo LIBVA_DRIVER_NAME=iHD >> /etc/environment

export LIBVA_DRIVERS_PATH=/usr/lib/x86_64-linux-gnu/dri
export LIBVA_DRIVER_NAME=iHD

echo "Installation complete"

fi


